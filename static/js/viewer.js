$(document).ready(function(){let o="",n=0,h=10,d=0,m=$("#browser-upload"),r=$("#loading-blocker"),l=$("#browser-body"),b=$("#browser-back");m.click(function(){if(o!=="")return;let i=$('<input type="file">');i.change(function(){r.show();let a=i[0].files,f=new FormData;f.append("file",a[0]),f.append("path",o),f.append("csrf_token",CSRF_TOKEN),$.ajax({url:"/api/datasets/upload",type:"POST",data:f,processData:!1,contentType:!1,success:function(u){u.is_success===!1?Swal.fire({icon:"error",title:"Oops...",text:u.message}):(Swal.fire({icon:"success",title:"Success",text:u.message}),$("#browser-refresh").click())},error:function(u){Swal.fire({icon:"error",title:"Oops...",text:"Error uploading files"}),console.log(u)},complete:function(){r.hide()}})}),i.click()});let p=i=>{$("table").DataTable().destroy(),i=i.replace("\\","/"),i===""?m.show():m.hide(),r.show(),l.append(`
        <tr id="tr-loader">
          <td colspan="8" class="text-center align-middle">
            <div class="spinner-border" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </td>
        </tr>
      `),i===""?b.addClass("disabled").attr("disabled",!0):b.removeClass("disabled").attr("disabled",!1),$.ajax({url:"/api/datasets/browse",type:"GET",data:{path:i,from:n,step:h},success:function(a){n===0&&l.empty(),$("#tr-loader").remove(),a.is_success?(a.result.elements.forEach((e,c)=>{let t=$(`<tr id="row-${e.path}"></tr>`);t.append(`<td class="text-center align-middle">${++d}</td>`),t.append(`<td class="text-center align-middle">${e.name}</td>`),e.type==="folder"?(t.append('<td class="text-center align-middle"><i class="fa fa-folder"></i></td>'),t.append('<td class="text-center align-middle">-</td>')):(t.append('<td class="text-center align-middle"><i class="fa fa-file"></i></td>'),e.size>1024*1024*1024?t.append(`<td class="text-center align-middle">${(e.size/(1024*1024*1024)).toFixed(2)} GB</td>`):e.size>1024*1024?t.append(`<td class="text-center align-middle">${(e.size/(1024*1024)).toFixed(2)} MB</td>`):e.size>1024?t.append(`<td class="text-center align-middle">${(e.size/1024).toFixed(2)} KB</td>`):t.append(`<td class="text-center align-middle">${e.size} B</td>`)),t.append(`<td class="text-center align-middle">${e.modifiedAt}</td>`),t.append(`<td class="text-center align-middle">${e.createdAt}</td>`),t.append(`<td class="text-center align-middle">${e.accessedAt}</td>`);let s="";if(e.type==="folder")s=`<button class="btn btn-sm btn-primary" title="Open" id="row-open-${e.path}">
                    <i class="fa fa-folder-open"></i>
                  </button>
                  <button class="btn btn-sm btn-danger" title="Delete" id="row-delete-${e.path}">
                    <i class="fa fa-trash"></i>
                  </button>`;else{let w="",g="";e.isImage&&(w=`<button class="btn btn-sm btn-success" title="View" id="row-view-${e.path}">
                    <i class="fa fa-eye"></i>
                  </button>
                  <img src="" id="row-view-${e.path}-image" class="d-none" width="25" height="25" alt="...">`),e.isCompressed&&(g=`<button class="btn btn-sm btn-secondary text-white" title="Uncompress" id="row-uncompress-${e.path}">
                    <i class="fa fa-file-zipper"></i>
                  </button>
                  <img src="" id="row-view-${e.path}-image" class="d-none" width="25" height="25" alt="...">`),s=`${g}${w}
                  <button class="btn btn-sm btn-danger" title="Delete" id="row-delete-${e.path}">
                    <i class="fa fa-trash"></i>
                  </button>`}t.append(`<td class="text-center align-middle"><div>${s}</div></td>`),l.append(t)}),$("#countFiles").html(`<span class="text-white w-auto bg-secondary badge">
            Showing ${d} from the ${a.result.count} files in this folder.</span>`),$('button[id^="row-view-"]').off().click(function(){let c=$(this).attr("id").replace("row-view-",""),t=document.getElementById(`row-view-${c}-image`);r.show(),$.ajax({url:"/api/datasets/image",type:"GET",data:{path:c},success:function(s){if(s.is_success){t.src=`data:image/jpeg;base64,${s.result}`;const w=new Viewer(t,{inline:!1,title:!1,toolbar:{zoomIn:4,zoomOut:4,oneToOne:4,reset:0,prev:0,play:{show:0,size:"large"},next:0,rotateLeft:4,rotateRight:4,flipHorizontal:4,flipVertical:4},hidden(){w.destroy()}});w.show()}else Swal.fire({icon:"error",title:"Oops...",text:s.message})},error:function(s){Swal.fire({icon:"error",title:"Oops...",text:"Error viewing image"}),console.log(s)},complete:function(){r.hide()}})}),$('button[id^="row-open-"]').off().click(function(){let e=$(this).attr("id").replace("row-open-","");l.empty(),d=0,n=0,o=e,p(e)}),$('button[id^="row-uncompress-"]').off().click(function(){Swal.fire({title:"Are you sure?",text:"Uncompressing this file will take a while, are you sure you want to continue?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, uncompress it!"}).then(e=>{if(e.isConfirmed){r.show();let c=$(this);$.ajax({url:"/api/datasets/uncompress",type:"POST",data:{path:o,item:c.attr("id"),csrf_token:CSRF_TOKEN},success:function(t){t.is_success?(Swal.fire({icon:"success",title:"Uncompressed",text:t.message}),$("#browser-refresh").click()):Swal.fire({icon:"error",title:"Oops...",text:t.message})},error:function(t){Swal.fire({icon:"error",title:"Oops...",text:t.message})},complete:function(){r.hide()}})}})}),$('button[id^="row-delete-"]').off().click(function(e){Swal.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(c=>{if(c.isConfirmed){r.show();let t=$(this);$.ajax({url:"/api/datasets/delete",type:"POST",data:{path:o,item:t.attr("id"),csrf_token:CSRF_TOKEN},success:function(s){s.is_success?(Swal.fire({icon:"success",title:"Deleted",text:s.message}),$("#browser-refresh").click()):Swal.fire({icon:"error",title:"Oops...",text:s.message})},error:function(s){Swal.fire({icon:"error",title:"Oops...",text:s.message})},complete:function(){r.hide()}})}})})):l.append(`
              <tr>
                <td colspan="8" class="text-center align-middle">
                  <h4 class="text-danger">
                    ${a.message}
                  </h4>
                </td>
              </tr>
            `)},error:function(a){Swal.fire({icon:"error",title:"Oops...",text:a.message})},complete:function(){r.hide(),$("table").DataTable({bDestroy:!0,initComplete:function(a,f){$("table").wrap("<div style='overflow:auto; width:100%;position:relative;'></div>")}}).draw()}})};p(o),$("#browser-home").click(function(){l.empty(),d=0,n=0,o="",p(o)}),$("#browser-refresh").click(function(){l.empty(),d=0,n=0,p(o)}),b.click(function(){l.empty(),d=0,n=0;let i=o.replace("\\","/");i=i.split("/"),i.pop(),o=i.join("/"),p(o)}),$("#loadMoreDatasetItems").off().click(function(){n+=h,p(o)})});